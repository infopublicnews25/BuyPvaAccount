<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Support Ticket Details - BuyPvaAccount</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, nofollow">
    <script src="config.js"></script>
    <style>
        :root {
            --bg: #f8fafc;
            --card: #fff;
            --line: #e5e7eb;
            --text: #111827;
            --muted: #6b7280;
            --ok: #16a34a;
            --danger: #ef4444;
            --primary: #2563eb;
            --support: #7c3aed;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        .ticket-header {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .ticket-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 16px;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .ticket-title::before {
            content: "üé´";
            font-size: 28px;
        }

        .ticket-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .meta-label {
            font-size: 12px;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .meta-value {
            font-size: 14px;
            color: var(--text);
            font-weight: 500;
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-badge.new {
            background: #ddd6fe;
            color: #7c3aed;
        }

        .status-badge.read {
            background: #dbeafe;
            color: #2563eb;
        }

        .status-badge.processing {
            background: #fef3c7;
            color: #d97706;
        }

        .status-badge.complete {
            background: #d1fae5;
            color: #059669;
        }

        .priority-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }

        .priority-indicator.high {
            background: #ef4444;
        }

        .priority-indicator.medium {
            background: #f59e0b;
        }

        .priority-indicator.low {
            background: #10b981;
        }

        .ticket-actions {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: opacity 0.2s;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            opacity: 0.9;
        }

        .btn-primary {
            background: var(--support);
            color: white;
        }

        .btn-secondary {
            background: white;
            border: 1px solid var(--line);
            color: var(--text);
        }

        .btn-success {
            background: #34d399;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .replies-section {
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .reply-item {
            border-bottom: 1px solid var(--line);
            padding: 24px;
        }

        .reply-item:last-child {
            border-bottom: none;
        }

        .reply-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .reply-author {
            font-weight: 600;
            color: var(--text);
            font-size: 16px;
        }

        .reply-date {
            color: var(--muted);
            font-size: 14px;
        }

        .reply-content {
            color: var(--text);
            line-height: 1.6;
            margin-bottom: 16px;
        }

        .reply-attachments {
            margin-top: 16px;
        }

        .attachments-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
        }

        .attachment-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .attachment-item {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: var(--bg);
            border: 1px solid var(--line);
            border-radius: 4px;
            font-size: 13px;
            color: var(--text);
            text-decoration: none;
            transition: background 0.2s;
        }

        .attachment-item:hover {
            background: #e2e8f0;
        }

        .attachment-item::before {
            content: "üìé";
            font-size: 14px;
        }

        .reply-form-section {
            background: white;
            border-radius: 8px;
            padding: 24px;
            margin-top: 20px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .reply-form-container h3 {
            margin: 0 0 20px 0;
            color: var(--text);
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reply-form-container h3::before {
            content: "üí¨";
            font-size: 20px;
        }

        .reply-form {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .form-group label {
            font-weight: 600;
            color: var(--text);
            font-size: 14px;
        }

        .form-group input,
        .form-group textarea {
            padding: 12px;
            border: 1px solid var(--line);
            border-radius: 6px;
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .reply-form-section.disabled {
            opacity: 0.6;
            pointer-events: none;
        }

        .reply-form-section.disabled::after {
            content: "üîí This ticket has been marked as solved. No further replies can be added.";
            display: block;
            text-align: center;
            color: var(--muted);
            font-style: italic;
            margin-top: 16px;
            padding: 12px;
            background: var(--bg);
            border-radius: 6px;
        }

        .no-ticket {
            text-align: center;
            padding: 80px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }

        .no-ticket::before {
            content: "üé´";
            font-size: 64px;
            display: block;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .no-ticket h2 {
            color: var(--text);
            margin-bottom: 8px;
        }

        .no-ticket p {
            color: var(--muted);
        }

        .ticket-info {
            background: #f1f5f9;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
        }

        .ticket-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .info-label {
            font-weight: 600;
            color: var(--text);
        }

        .info-value {
            color: var(--muted);
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .ticket-meta {
                grid-template-columns: 1fr;
            }

            .reply-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .ticket-actions {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                justify-content: center;
            }
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ticket Header -->
        <div id="ticketHeader" class="ticket-header" style="display: none;">
            <div class="ticket-title">
                Case Tracking ID: <span id="trackingId">Loading...</span>
            </div>

            <div class="ticket-meta">
                <div class="meta-item">
                    <div class="meta-label">Ticket Status</div>
                    <div class="meta-value">
                        <span id="ticketStatus" class="status-badge">Loading...</span>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Created On</div>
                    <div class="meta-value" id="createdDate">Loading...</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Updated</div>
                    <div class="meta-value" id="updatedDate">Loading...</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Category</div>
                    <div class="meta-value" id="ticketCategory">Loading...</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Priority</div>
                    <div class="meta-value">
                        <span id="ticketPriority">Loading...</span>
                    </div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Replies</div>
                    <div class="meta-value" id="replyCount">0</div>
                </div>
            </div>

            <div class="ticket-actions">
                <button class="btn btn-secondary" onclick="window.history.back()">
                    ‚Üê Back to Tickets
                </button>
                <button class="btn btn-primary" onclick="location.reload()">
                    üîÑ Refresh Page
                </button>
                <button id="solveBtn" class="btn btn-success" onclick="markTicketSolved()" style="display: none;">
                    ‚úÖ Mark as Solved
                </button>
                <button id="unsolveBtn" class="btn btn-warning" onclick="markTicketUnsolved()" style="display: none;">
                    ‚ùå Mark as Unsolved
                </button>
            </div>
        </div>

        <!-- Ticket Information -->
        <div id="ticketInfo" class="ticket-info" style="display: none;">
            <div class="ticket-info-grid">
                <div class="info-item">
                    <span class="info-label">Account Type:</span>
                    <span class="info-value" id="accountType">N/A</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Account Link:</span>
                    <span class="info-value" id="accountLink">N/A</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Payment Date:</span>
                    <span class="info-value" id="paymentDate">N/A</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Payment Method:</span>
                    <span class="info-value" id="paymentMethod">N/A</span>
                </div>
            </div>
        </div>

        <!-- Replies Section -->
        <div id="repliesSection" class="replies-section" style="display: none;">
            <!-- Replies will be loaded here -->
        </div>

        <!-- Reply Form -->
        <div id="replyFormSection" class="reply-form-section" style="display: none;">
            <div class="reply-form-container">
                <h3>Add Reply</h3>
                <form id="replyForm" class="reply-form">
                    <div class="form-group">
                        <label for="replyMessage">Message:</label>
                        <textarea id="replyMessage" rows="4" required placeholder="Type your reply here..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">üì§ Post Reply</button>
                        <button type="button" class="btn btn-secondary" onclick="clearReplyForm()">üóëÔ∏è Clear</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- No Ticket Found -->
        <div id="noTicket" class="no-ticket">
            <h2>Ticket Not Found</h2>
            <p>The requested support ticket could not be found or may have been deleted.</p>
            <button class="btn btn-primary" onclick="window.location.href='support-notifications.html'">
                ‚Üê Back to Support Tickets
            </button>
        </div>
    </div>

    <script>
        // Configuration
        const REQUESTS_KEY = 'account_requests';
        const SECURE_LINKS_KEY = 'secure_ticket_links';

        // Get ticket token from URL parameters
        function getTicketToken() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('token');
        }

        // Generate secure token
        function generateSecureToken() {
            return 'tk_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Create secure link for ticket
        function createSecureLink(trackingId) {
            const token = generateSecureToken();
            const secureLinks = JSON.parse(localStorage.getItem(SECURE_LINKS_KEY) || '{}');

            // Store the mapping
            secureLinks[token] = trackingId;
            localStorage.setItem(SECURE_LINKS_KEY, JSON.stringify(secureLinks));

            return `/support-ticket.html?token=${token}`;
        }

        // Load ticket details
        function loadTicketDetails() {
            const token = getTicketToken();
            if (!token) {
                showNoTicket();
                return;
            }

            // Extract tracking ID from token (it's in format: tk_timestamp_randomstring_TRACKINGID)
            // Or try to get it from localStorage first, then fallback to API
            
            // Try localStorage first
            const secureLinks = JSON.parse(localStorage.getItem(SECURE_LINKS_KEY) || '{}');
            let trackingId = secureLinks[token];

            if (trackingId) {
                // Found in localStorage, load from there
                const requests = JSON.parse(localStorage.getItem(REQUESTS_KEY) || '[]');
                const ticket = requests.find(r => r.trackingId === trackingId && r.category && r.subject);
                if (ticket) {
                    displayTicketDetails(ticket);
                    return;
                }
            }

            // If not in localStorage, try API endpoint
            fetchTicketFromBackend(token);
        }

        // Fetch ticket from backend API
        async function fetchTicketFromBackend(token) {
            try {
                const res = await fetch(`${CONFIG.API}/ticket/${encodeURIComponent(token)}`);
                if (!res.ok) {
                    showNoTicket();
                    return;
                }
                const data = await res.json();
                if (data.success && data.ticket) {
                    displayTicketDetails(data.ticket);
                } else {
                    showNoTicket();
                }
            } catch (err) {
                console.error('Error fetching ticket:', err);
                showNoTicket();
            }
        }

        // Display ticket details
        function displayTicketDetails(ticket) {
            // Hide no ticket message
            document.getElementById('noTicket').style.display = 'none';

            // Show ticket header
            document.getElementById('ticketHeader').style.display = 'block';
            document.getElementById('ticketInfo').style.display = 'block';
            document.getElementById('repliesSection').style.display = 'block';
            document.getElementById('replyFormSection').style.display = 'block';

            // Update header information
            document.getElementById('trackingId').textContent = ticket.trackingId;
            document.getElementById('ticketStatus').textContent = ticket.status || 'new';
            document.getElementById('ticketStatus').className = `status-badge ${ticket.status || 'new'}`;

            const createdDate = new Date(ticket.timestamp).toLocaleString();
            document.getElementById('createdDate').textContent = createdDate;
            document.getElementById('updatedDate').textContent = createdDate; // For now, same as created
            document.getElementById('ticketCategory').textContent = ticket.category;

            const priorityHtml = `<span class="priority-indicator ${ticket.priority.toLowerCase()}"></span>${ticket.priority}`;
            document.getElementById('ticketPriority').innerHTML = priorityHtml;

            // Update ticket information
            document.getElementById('accountType').textContent = ticket.accountType || 'N/A';
            document.getElementById('accountLink').textContent = ticket.accountLink || 'N/A';
            document.getElementById('paymentDate').textContent = ticket.paymentDate || 'N/A';
            document.getElementById('paymentMethod').textContent = ticket.paymentMethod || 'N/A';

            // Update solve/unsolve button visibility
            updateSolveButtons(ticket.status || 'new');

            // Display replies
            displayReplies(ticket);
        }

        // Display replies/messages
        function displayReplies(ticket) {
            const repliesContainer = document.getElementById('repliesSection');
            repliesContainer.innerHTML = '';

            // Initialize replies array if it doesn't exist
            if (!ticket.replies) {
                ticket.replies = [];
            }

            // Add original message first
            const originalReply = createReplyItem({
                date: ticket.timestamp,
                name: ticket.name || 'Customer',
                email: ticket.email,
                message: ticket.message,
                attachments: ticket.attachments || [],
                isOriginal: true
            });
            repliesContainer.appendChild(originalReply);

            // Add all replies in chronological order
            ticket.replies.forEach(reply => {
                const replyDiv = createReplyItem(reply);
                repliesContainer.appendChild(replyDiv);
            });

            // Update reply count
            document.getElementById('replyCount').textContent = ticket.replies.length + 1;
        }

        // Create reply item
        function createReplyItem(reply) {
            const replyDiv = document.createElement('div');
            replyDiv.className = 'reply-item';

            const replyDate = new Date(reply.date).toLocaleString();
            const authorType = reply.isOriginal ? 'üë§ Customer' : 'üõ†Ô∏è Support Team';

            replyDiv.innerHTML = `
                <div class="reply-header">
                    <div class="reply-author">${reply.name} <span style="color: var(--muted); font-size: 12px; font-weight: normal;">(${authorType})</span></div>
                    <div class="reply-date">${replyDate}</div>
                </div>
                <div class="reply-content">${reply.message.replace(/\n/g, '<br>')}</div>
                ${reply.attachments && reply.attachments.length > 0 ? `
                    <div class="reply-attachments">
                        <div class="attachments-title">Attachments:</div>
                        <div class="attachment-list">
                            ${reply.attachments.map(attachment => `
                                <a href="#" class="attachment-item" onclick="downloadAttachment('${attachment.name}')">
                                    ${attachment.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
            `;

            return replyDiv;
        }

        // Download attachment (placeholder function)
        function downloadAttachment(filename) {
            alert(`Downloading: ${filename}\n\nThis is a placeholder. In a real system, this would download the actual file.`);
        }

        // Mark ticket as solved
        function markTicketSolved() {
            const token = getTicketToken();
            if (!token) return;

            const secureLinks = JSON.parse(localStorage.getItem(SECURE_LINKS_KEY) || '{}');
            const trackingId = secureLinks[token];

            if (!trackingId) return;

            const requests = JSON.parse(localStorage.getItem(REQUESTS_KEY) || '[]');
            const ticketIndex = requests.findIndex(r => r.trackingId === trackingId);

            if (ticketIndex !== -1) {
                requests[ticketIndex].status = 'complete';
                localStorage.setItem(REQUESTS_KEY, JSON.stringify(requests));

                // Update the UI
                document.getElementById('ticketStatus').textContent = 'complete';
                document.getElementById('ticketStatus').className = 'status-badge complete';
                document.getElementById('updatedDate').textContent = new Date().toLocaleString();

                // Update button visibility
                updateSolveButtons('complete');

                // Show success message
                showStatusMessage('Ticket marked as solved!', 'success');
            }
        }

        // Mark ticket as unsolved
        function markTicketUnsolved() {
            const token = getTicketToken();
            if (!token) return;

            const secureLinks = JSON.parse(localStorage.getItem(SECURE_LINKS_KEY) || '{}');
            const trackingId = secureLinks[token];

            if (!trackingId) return;

            const requests = JSON.parse(localStorage.getItem(REQUESTS_KEY) || '[]');
            const ticketIndex = requests.findIndex(r => r.trackingId === trackingId);

            if (ticketIndex !== -1) {
                requests[ticketIndex].status = 'processing';
                localStorage.setItem(REQUESTS_KEY, JSON.stringify(requests));

                // Update the UI
                document.getElementById('ticketStatus').textContent = 'processing';
                document.getElementById('ticketStatus').className = 'status-badge processing';
                document.getElementById('updatedDate').textContent = new Date().toLocaleString();

                // Update button visibility
                updateSolveButtons('processing');

                // Show success message
                showStatusMessage('Ticket marked as unsolved!', 'warning');
            }
        }

        // Update solve/unsolve button visibility based on status
        function updateSolveButtons(status) {
            const solveBtn = document.getElementById('solveBtn');
            const unsolveBtn = document.getElementById('unsolveBtn');
            const replyFormSection = document.getElementById('replyFormSection');

            if (status === 'complete') {
                solveBtn.style.display = 'none';
                unsolveBtn.style.display = 'inline-flex';
                replyFormSection.classList.add('disabled');
            } else {
                solveBtn.style.display = 'inline-flex';
                unsolveBtn.style.display = 'none';
                replyFormSection.classList.remove('disabled');
            }
        }

        // Show status message
        function showStatusMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 12px 20px;
                border-radius: 6px;
                color: white;
                font-weight: 500;
                z-index: 1000;
                animation: slideIn 0.3s ease-out;
            `;

            if (type === 'success') {
                messageDiv.style.background = '#10b981';
            } else if (type === 'warning') {
                messageDiv.style.background = '#f59e0b';
            }

            messageDiv.innerHTML = message;

            document.body.appendChild(messageDiv);

            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from { transform: translateX(100%); opacity: 0; }
                    to { transform: translateX(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);

            // Remove after 3 seconds
            setTimeout(() => {
                messageDiv.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    document.body.removeChild(messageDiv);
                }, 300);
            }, 3000);
        }

        // Show no ticket found message
        function showNoTicket() {
            document.getElementById('ticketHeader').style.display = 'none';
            document.getElementById('ticketInfo').style.display = 'none';
            document.getElementById('repliesSection').style.display = 'none';
            document.getElementById('replyFormSection').style.display = 'none';
            document.getElementById('noTicket').style.display = 'block';
        }

        // Handle reply form submission
        async function handleReplySubmission(e) {
            e.preventDefault();

            const token = getTicketToken();
            if (!token) return;

            const secureLinks = JSON.parse(localStorage.getItem(SECURE_LINKS_KEY) || '{}');
            const trackingId = secureLinks[token];

            if (!trackingId) return;

            const message = document.getElementById('replyMessage').value.trim();

            if (!message) {
                showStatusMessage('Please enter a message', 'warning');
                return;
            }

            // Create new reply
            const newReply = {
                date: new Date().toISOString(),
                name: 'Support Team', // Default name since field was removed
                email: '',
                message: message,
                attachments: []
            };

            // Add reply to ticket
            const requests = JSON.parse(localStorage.getItem(REQUESTS_KEY) || '[]');
            const ticketIndex = requests.findIndex(r => r.trackingId === trackingId);

            if (ticketIndex !== -1) {
                if (!requests[ticketIndex].replies) {
                    requests[ticketIndex].replies = [];
                }
                requests[ticketIndex].replies.push(newReply);
                localStorage.setItem(REQUESTS_KEY, JSON.stringify(requests));

                // Send email notification to customer
                try {
                    console.log('Sending reply notification email to customer...');
                    const emailResponse = await fetch('http://localhost:3000/api/send-ticket-reply-notification', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            customerEmail: requests[ticketIndex].email,
                            ticketData: {
                                trackingId: requests[ticketIndex].trackingId,
                                name: requests[ticketIndex].name,
                                subject: requests[ticketIndex].subject,
                                status: requests[ticketIndex].status || 'Open',
                                ticketLink: window.location.href // Current page URL
                            },
                            replyData: newReply
                        })
                    });

                    if (emailResponse.ok) {
                        const emailResult = await emailResponse.json();
                        console.log('Reply notification email sent successfully:', emailResult);
                    } else {
                        console.error('Reply notification email failed:', emailResponse.status, emailResponse.statusText);
                        // Don't show error to user, just log it - reply was still saved
                    }
                } catch (emailError) {
                    console.error('Reply notification email network error:', emailError);
                    // Don't show error to user, just log it - reply was still saved
                }

                // Update the UI
                displayReplies(requests[ticketIndex]);
                clearReplyForm();

                // Show success message
                showStatusMessage('Reply posted successfully! Customer has been notified via email.', 'success');
            }
        }

        // Clear reply form
        function clearReplyForm() {
            document.getElementById('replyMessage').value = '';
        }

        // Initialize reply form event listener
        document.addEventListener('DOMContentLoaded', function() {
            loadTicketDetails();

            // Add reply form event listener
            const replyForm = document.getElementById('replyForm');
            if (replyForm) {
                replyForm.addEventListener('submit', handleReplySubmission);
            }
        });
    </script>
</body>
</html>