<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Admin - Product Management</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="robots" content="noindex, nofollow"> <!-- Prevent search engine indexing -->
    <style>
        :root {
            --bg: #f8fafc;
            --card: #fff;
            --line: #e5e7eb;
            --text: #111827;
            --muted: #6b7280;
            --ok: #16a34a;
            --danger: #ef4444;
            --primary: #2563eb;
        }

        /* Main Layout Styles */
        .container {
            max-width: 1280px;
            margin: 0 auto;
            padding: 20px;
        }

        .top-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .top-header h1 {
            font-size: 24px;
            margin: 0;
            color: var(--text);
        }

        .grid-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
            margin-bottom: 24px;
        }

        .product-section, .news-section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 20px;
            margin: 0;
        }

        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 24px;
        }

        .product-section, .news-section {
            background: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .form-group {
            margin-bottom: 16px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--line);
            border-radius: 6px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 16px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--line);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }

        .tab-navigation {
            display: flex;
            gap: 0;
            margin-bottom: 24px;
        }

        .tab-btn {
            padding: 12px 24px;
            background: var(--card);
            border: 1px solid var(--line);
            border-bottom: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            border-radius: 8px 8px 0 0;
        }

        .tab-btn:hover {
            background: var(--bg);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Role and Status Badges */
        .role-badge, .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            text-transform: capitalize;
        }

        .role-admin { background: #fef3c7; color: #92400e; }
        .role-editor { background: #dbeafe; color: #1e40af; }
        .role-moderator { background: #e0e7ff; color: #3730a3; }
        .role-manager { background: #d1fae5; color: #065f46; }

        .status-active { background: #d1fae5; color: #065f46; }
        .status-inactive { background: #fee2e2; color: #991b1b; }

        /* Login form styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: var(--bg);
        }
        
        .login-card {
            background: white;
            padding: 30px;
            border-radius: 14px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 90%;
            max-width: 400px;
        }

        .login-title {
            text-align: center;
            margin-bottom: 24px;
            color: var(--text);
        }

        .error-message {
            color: var(--danger);
            text-align: center;
            margin-bottom: 16px;
            display: none;
        }

        body {
            margin: 0;
            background: var(--bg);
            color: var(--text);
            font-family: Segoe UI, Tahoma, Arial, sans-serif;
        }

        .container {
            max-width: 1280px;
            margin: 24px auto;
            padding: 0 16px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .header h1 {
            margin: 0;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid var(--line);
            border-radius: 8px;
            box-sizing: border-box;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            font-weight: 600;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-success {
            background: var(--ok);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .product-list {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            margin-top: 16px;
        }

        .product-list th,
        .product-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--line);
            vertical-align: middle;
        }

        .product-list th {
            background: var(--bg);
            font-weight: 600;
            font-size: 14px;
            color: var(--text);
        }

        .product-list td {
            font-size: 14px;
        }

        .product-list tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.02);
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 14px;
        }

        .status-in-stock {
            background: #dcfce7;
            color: var(--ok);
        }

        .status-out-of-stock {
            background: #fee2e2;
            color: var(--danger);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        #editModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 14px;
            width: 90%;
            max-width: 600px;
            margin: 50px auto;
        }

        .close {
            float: right;
            font-size: 24px;
            cursor: pointer;
        }

        .preview-image {
            max-width: 100px;
            max-height: 100px;
            margin: 10px 0;
        }

        /* Notification Styles */
        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-item {
            background: #f8fafc;
            border: 1px solid var(--line);
            border-radius: 8px;
            padding: 12px;
        }

        .notification-item.new {
            border-left: 3px solid var(--primary);
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .notification-time {
            font-size: 12px;
            color: var(--muted);
        }

        .notification-content {
            margin-bottom: 8px;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
        }

        .notification-actions button {
            padding: 4px 8px;
            font-size: 12px;
        }

        /* News Management Styles */
        #newsModal .card {
            background: var(--card);
            border: 1px solid var(--line);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 20px;
        }

        #newsModal .form-control {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid var(--line);
            border-radius: 8px;
            font-size: 16px;
            line-height: 1.5;
            box-sizing: border-box;
        }

        #newsModal table {
            width: 100%;
            border-collapse: collapse;
        }

        #newsModal table th,
        #newsModal table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--line);
        }

        #newsModal table th {
            font-weight: 600;
            background-color: var(--bg);
        }

        #newsModal .actions {
            display: flex;
            gap: 8px;
        }

        /* News Management Styles */
        .news-list-container {
            max-height: 600px;
            overflow-y: auto;
        }

        .news-list .news-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid var(--line);
        }

        .news-list .news-item:last-child {
            border-bottom: none;
        }

        .news-content {
            flex: 1;
            margin-right: 12px;
        }

        .news-date {
            font-weight: 600;
            color: #f97316;
            min-width: 80px;
        }

        .news-actions {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background: #f59e0b;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-edit:hover {
            background: #d97706;
        }

        .btn-delete {
            background: #ef4444;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .btn-delete:hover {
            background: #dc2626;
        }

        .form-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }
    </style>
</head>

<body>
    <!-- Login Form -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <h2 class="login-title">Admin Login</h2>
            <div id="errorMessage" class="error-message"></div>
            <form id="loginForm" onsubmit="return handleLogin(event)">
                <div class="form-group">
                    <label for="username">Username</label>
                    <input type="text" id="username" required autocomplete="username">
                </div>
                <div class="form-group">
                    <label for="password">Password</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%">Login</button>
            </form>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div id="adminDashboard" style="display: none;">
        <div class="container">
            <div class="top-header">
                <h1>Admin Dashboard</h1>
                <div style="display: flex; gap: 12px;">
                    <button class="btn btn-primary" onclick="window.location.href='ordermanagement.html'">Order Management</button>
                    <button class="btn btn-danger" onclick="handleLogout()">Logout</button>
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="tab-navigation" style="margin-bottom: 24px; border-bottom: 2px solid var(--line);">
                <button class="tab-btn active" data-tab="products" onclick="switchTab('products')">üì¶ Products</button>
                <button class="tab-btn" data-tab="users" onclick="switchTab('users')">üë• User Management</button>
                <button class="tab-btn" data-tab="pages" onclick="switchTab('pages')">üìÑ Pages</button>
                <button class="tab-btn" data-tab="posts" onclick="switchTab('posts')">üìù Posts</button>
                <button class="tab-btn" data-tab="news" onclick="switchTab('news')">üì∞ News & Updates</button>
                <button class="tab-btn" data-tab="settings" onclick="switchTab('settings')">‚öôÔ∏è Settings</button>
            </div>

            <!-- Products Tab -->
            <div id="productsTab" class="tab-content active">
                <!-- Main Grid Layout -->
                <div class="grid-container">
                    <!-- Products Section -->
                    <div class="product-section" style="width: 100%;">
                        <div class="section-header">
                            <h2>Products</h2>
                            <button class="btn btn-primary" onclick="openAddModal()">Add New Product</button>
                        </div>
                        <table class="product-list">
                            <thead>
                                <tr>
                                    <th>Image</th>
                                    <th>Title</th>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="productTableBody">
                                <!-- Products will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="tab-content">
                <div class="user-management-section" style="width: 100%;">
                    <h2>üë• User & Access Management</h2>
                    
                    <!-- Add User Form -->
                    <form id="userForm" onsubmit="addUser(event)" style="margin-bottom: 20px; background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3>Add New User</h3>
                        <div class="form-group">
                            <label for="userUsername">Username</label>
                            <input type="text" id="userUsername" required placeholder="Enter username">
                        </div>
                        <div class="form-group">
                            <label for="userEmail">Email</label>
                            <input type="email" id="userEmail" required placeholder="Enter email">
                        </div>
                        <div class="form-group">
                            <label for="userRole">Role</label>
                            <select id="userRole" required>
                                <option value="editor">Editor</option>
                                <option value="moderator">Moderator</option>
                                <option value="manager">Manager</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="userPassword">Temporary Password</label>
                            <input type="password" id="userPassword" required placeholder="Temporary password">
                        </div>
                        <button type="submit" class="btn btn-primary">Add User</button>
                    </form>

                    <!-- Users List -->
                    <table class="product-list" style="width: 100%;">
                        <thead>
                            <tr>
                                <th>Username</th>
                                <th>Email</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Last Login</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Pages Tab -->
            <div id="pagesTab" class="tab-content">
                <div class="pages-management-section" style="width: 100%;">
                    <h2>üìÑ Pages Management</h2>
                    
                    <!-- Add Page Form -->
                    <form id="pageForm" onsubmit="addPage(event)" style="margin-bottom: 20px; background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3 id="pageFormTitle">Add New Page</h3>
                        <input type="hidden" id="pageEditId" value="">
                        <div class="form-group">
                            <label for="pageTitle">Title</label>
                            <input type="text" id="pageTitle" required placeholder="Enter page title">
                        </div>
                        <div class="form-group">
                            <label for="pageSlug">Slug</label>
                            <input type="text" id="pageSlug" required placeholder="Enter page slug (e.g., about-us)">
                        </div>
                        <div class="form-group">
                            <label for="pageContent">Content</label>
                            <textarea id="pageContent" required placeholder="Enter page content (HTML allowed)" rows="10"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="pageStatus">Status</label>
                            <select id="pageStatus" required>
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="pageSubmitBtn">Add Page</button>
                            <button type="button" class="btn btn-secondary" id="pageCancelBtn" onclick="cancelPageEdit()" style="display: none;">Cancel</button>
                        </div>
                    </form>

                    <!-- Pages List -->
                    <div style="background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3>Current Pages</h3>
                        <table class="product-list" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Slug</th>
                                    <th>Status</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pagesTableBody">
                                <!-- Pages will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Posts Tab -->
            <div id="postsTab" class="tab-content">
                <div class="posts-management-section" style="width: 100%;">
                    <h2>üìù Posts Management</h2>
                    
                    <!-- Add Post Form -->
                    <form id="postForm" onsubmit="addPost(event)" style="margin-bottom: 20px; background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3 id="postFormTitle">Add New Post</h3>
                        <input type="hidden" id="postEditId" value="">
                        <div class="form-group">
                            <label for="postTitle">Title</label>
                            <input type="text" id="postTitle" required placeholder="Enter post title">
                        </div>
                        <div class="form-group">
                            <label for="postSlug">Slug</label>
                            <input type="text" id="postSlug" required placeholder="Enter post slug (e.g., my-first-post)">
                        </div>
                        <div class="form-group">
                            <label for="postContent">Content</label>
                            <textarea id="postContent" required placeholder="Enter post content (HTML allowed)" rows="10"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="postCategories">Categories (comma-separated)</label>
                            <input type="text" id="postCategories" placeholder="e.g., news, updates">
                        </div>
                        <div class="form-group">
                            <label for="postTags">Tags (comma-separated)</label>
                            <input type="text" id="postTags" placeholder="e.g., important, featured">
                        </div>
                        <div class="form-group">
                            <label for="postStatus">Status</label>
                            <select id="postStatus" required>
                                <option value="draft">Draft</option>
                                <option value="published">Published</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="postSubmitBtn">Add Post</button>
                            <button type="button" class="btn btn-secondary" id="postCancelBtn" onclick="cancelPostEdit()" style="display: none;">Cancel</button>
                        </div>
                    </form>

                    <!-- Posts List -->
                    <div style="background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3>Current Posts</h3>
                        <table class="product-list" style="width: 100%;">
                            <thead>
                                <tr>
                                    <th>Title</th>
                                    <th>Slug</th>
                                    <th>Categories</th>
                                    <th>Status</th>
                                    <th>Updated</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="postsTableBody">
                                <!-- Posts will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- News & Updates Tab -->
            <div id="newsTab" class="tab-content">
                <div class="news-management-section" style="width: 100%;">
                    <h2>üì∞ News & Updates Management</h2>
                    
                    <!-- Add News Form -->
                    <form id="newsForm" onsubmit="addNews(event)" style="margin-bottom: 20px; background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3 id="newsFormTitle">Add New News/Update</h3>
                        <input type="hidden" id="editIndex" value="-1">
                        <div class="form-group">
                            <label for="newsDate">Date</label>
                            <input type="text" id="newsDate" required placeholder="e.g., Nov 2025" value="Nov 2025">
                        </div>
                        <div class="form-group">
                            <label for="newsContent">Content</label>
                            <textarea id="newsContent" required placeholder="Enter news content" rows="3"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="submitBtn">Add News</button>
                            <button type="button" class="btn btn-secondary" id="cancelBtn" onclick="cancelEdit()" style="display: none;">Cancel</button>
                        </div>
                    </form>

                    <!-- News List -->
                    <div class="news-list-container" style="background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line);">
                        <h3>Current News & Updates</h3>
                        <div id="adminNewsContainer" class="news-list">
                            <!-- News items will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="settings-section" style="width: 100%;">
                    <h2>‚öôÔ∏è Admin Settings</h2>
                    
                    <!-- Change Admin Credentials -->
                    <div style="background: var(--card); padding: 20px; border-radius: 8px; border: 1px solid var(--line); margin-bottom: 20px;">
                        <h3>Change Admin Credentials</h3>
                        <form id="adminCredentialsForm" onsubmit="updateAdminCredentials(event)">
                            <div class="form-group">
                                <label for="adminUsername">New Username</label>
                                <input type="text" id="adminUsername" required placeholder="Enter new username">
                            </div>
                            <div class="form-group">
                                <label for="adminPassword">New Password</label>
                                <input type="password" id="adminPassword" required placeholder="Enter new password">
                            </div>
                            <button type="submit" class="btn btn-primary">Update Credentials</button>
                        </form>
                    </div>
                </div>
            </div>
    </div>
    <div id="editModal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle">Edit Product</h2>
            <form id="productForm" onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label for="title">Title</label>
                    <input type="text" id="title" required>
                </div>
                <div class="form-group">
                    <label for="price">Regular Price ($)</label>
                    <input type="number" id="price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="offerPrice">Offer Price ($)</label>
                    <input type="number" id="offerPrice" step="0.01" placeholder="Leave empty for no offer">
                </div>
                <div class="form-group">
                    <label for="quantity">Quantity</label>
                    <input type="number" id="quantity" required>
                </div>
                <div class="form-group">
                    <label for="note">Product Description</label>
                    <div style="border: 1px solid var(--line); border-radius: 8px; padding: 5px;">
                        <div class="editor-toolbar" style="padding: 5px; border-bottom: 1px solid var(--line);">
                            <button type="button" onclick="formatText('bold')" class="btn" style="padding: 5px 10px; margin-right: 5px;"><b>B</b></button>
                            <button type="button" onclick="formatText('italic')" class="btn" style="padding: 5px 10px; margin-right: 5px;"><i>I</i></button>
                            <button type="button" onclick="formatText('underline')" class="btn" style="padding: 5px 10px; margin-right: 5px;"><u>U</u></button>
                            <button type="button" onclick="formatText('insertunorderedlist')" class="btn" style="padding: 5px 10px; margin-right: 5px;">‚Ä¢ List</button>
                        </div>
                        <div id="note" contenteditable="true" style="min-height: 150px; padding: 10px; outline: none;"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="image">Image URL</label>
                    <input type="text" id="image" placeholder="Enter image URL">
                    <img id="imagePreview" class="preview-image" hidden>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="forceZero"> Force Out of Stock
                    </label>
                </div>
                <button type="submit" class="btn btn-success">Save Changes</button>
            </form>
        </div>
    </div>

    </div>
    </div>

    <script>
        // Authentication configuration
        const AUTH_KEY = 'admin_auth';
        const PRODUCTS_KEY = 'admin_products_v1';
        
        // Help Section Functions
        function submitHelp(event) {
            event.preventDefault();
            const topic = document.getElementById('helpTopic').value;
            const message = document.getElementById('helpMessage').value;
            const email = document.getElementById('helpEmail').value;

            // You can implement the actual help submission logic here
            alert(`Help request received!\n\nTopic: ${topic}\nEmail: ${email}\n\nWe'll respond to your message soon.`);
            
            // Clear the form
            document.getElementById('helpForm').reset();
        }
        
        // Function to format date for display
        function formatDate(dateString) {
            if (!dateString) return 'Never';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (error) {
                return 'Invalid Date';
            }
        }
        
        // Function to hash password (using SHA-256)
        // Handle login
        async function handleLogin(event) {
            event.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMsg = document.getElementById('errorMessage');
            
            try {
                const response = await fetch('http://localhost:3000/api/admin-login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Store auth token from backend
                    localStorage.setItem(AUTH_KEY, data.token);
                    
                    // Show admin dashboard
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';
                    
                    // Initialize the products tab by default
                    switchTab('products');
                } else {
                    errorMsg.style.display = 'block';
                    errorMsg.textContent = data.message || 'Invalid username or password';
                }
            } catch (error) {
                console.error('Login error:', error);
                errorMsg.style.display = 'block';
                errorMsg.textContent = 'Unable to connect to server. Please try again.';
            }
        }

        // News Management Functions
        function loadAdminNews() {
            const newsContainer = document.getElementById('adminNewsContainer');
            const news = JSON.parse(localStorage.getItem('newsUpdates') || '[]');
            
            if (news.length === 0) {
                newsContainer.innerHTML = '<p style="color: var(--text-secondary); text-align: center; padding: 20px;">No news items yet. Add your first news update above.</p>';
            } else {
                newsContainer.innerHTML = news.map((item, index) => `
                    <div class="news-item">
                        <div class="news-content">
                            <span class="news-date">${item.date}</span>
                            <span>${item.content}</span>
                        </div>
                        <div class="news-actions">
                            <button class="btn-edit" onclick="editNews(${index})">Edit</button>
                            <button class="btn-delete" onclick="deleteNews(${index})">Delete</button>
                        </div>
                    </div>
                `).join('');
            }
        }

        function addNews(event) {
            event.preventDefault();
            
            const date = document.getElementById('newsDate').value.trim();
            const content = document.getElementById('newsContent').value.trim();
            const editIndex = parseInt(document.getElementById('editIndex').value);
            
            if (!date || !content) {
                alert('Please fill in both date and content');
                return;
            }

            const news = JSON.parse(localStorage.getItem('newsUpdates') || '[]');
            
            if (editIndex >= 0) {
                // Edit existing news
                news[editIndex] = { date, content };
                alert('News updated successfully!');
            } else {
                // Add new news
                news.unshift({ date, content }); // Add to beginning
                alert('News added successfully!');
            }
            
            localStorage.setItem('newsUpdates', JSON.stringify(news));
            
            // Reset form
            cancelEdit();
            
            // Reload news
            loadAdminNews();
        }

        function editNews(index) {
            const news = JSON.parse(localStorage.getItem('newsUpdates') || '[]');
            const item = news[index];
            
            if (!item) return;
            
            // Populate form with existing data
            document.getElementById('newsDate').value = item.date;
            document.getElementById('newsContent').value = item.content;
            document.getElementById('editIndex').value = index;
            
            // Update form UI
            document.getElementById('newsFormTitle').textContent = 'Edit News/Update';
            document.getElementById('submitBtn').textContent = 'Update News';
            document.getElementById('cancelBtn').style.display = 'inline-block';
            
            // Scroll to form
            document.getElementById('newsForm').scrollIntoView({ behavior: 'smooth' });
        }

        function cancelEdit() {
            // Reset form
            document.getElementById('newsForm').reset();
            document.getElementById('newsDate').value = 'Nov 2025';
            document.getElementById('editIndex').value = '-1';
            
            // Reset form UI
            document.getElementById('newsFormTitle').textContent = 'Add New News/Update';
            document.getElementById('submitBtn').textContent = 'Add News';
            document.getElementById('cancelBtn').style.display = 'none';
        }

        function deleteNews(index) {
            if (!confirm('Are you sure you want to delete this news item?')) return;
            
            const news = JSON.parse(localStorage.getItem('newsUpdates') || '[]');
            news.splice(index, 1);
            
            localStorage.setItem('newsUpdates', JSON.stringify(news));
            loadAdminNews();
        }

        // Tab Switching Function
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            const selectedTab = document.getElementById(tabName + 'Tab');
            if (selectedTab) {
                selectedTab.classList.add('active');
            }
            
            // Activate corresponding button
            const selectedBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('active');
            }
            
            // Load content based on tab
            if (tabName === 'products') {
                renderProducts();
            } else if (tabName === 'users') {
                loadUsers();
            }
        }

        // User Management Functions
        async function loadUsers() {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    displayUsers(data.users);
                } else {
                    console.error('Failed to load users:', data.message);
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach((user, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge role-${user.role}">${user.role}</span></td>
                    <td><span class="status-badge status-${user.status || 'active'}">${user.status || 'active'}</span></td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'Never'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editUser('${user.username}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.username}')">Delete</button>
                        <button class="btn btn-info btn-sm" onclick="resetPassword('${user.username}')">Reset Password</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function addUser(event) {
            event.preventDefault();
            const username = document.getElementById('userUsername').value;
            const email = document.getElementById('userEmail').value;
            const role = document.getElementById('userRole').value;
            const password = document.getElementById('userPassword').value;

            if (!username || !email || !role || !password) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/admin/users', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, email, role, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Clear form
                    document.getElementById('userForm').reset();
                    loadUsers();
                    alert('User added successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert('Failed to add user');
            }
        }

        async function editUser(username) {
            // For now, just show an alert. In a full implementation, you'd fetch user data and populate the form
            alert(`Edit user: ${username}\n\nThis would populate the form with user data for editing.`);
        }

        async function deleteUser(username) {
            if (confirm(`Are you sure you want to delete user: ${username}?`)) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/admin/users/${username}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        loadUsers();
                        alert('User deleted successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Failed to delete user');
                }
            }
        }

        async function resetPassword(username) {
            const newPassword = prompt(`Enter new temporary password for ${username}:`);
            if (newPassword) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/admin/users/${username}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password: newPassword })
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('Password reset successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error resetting password:', error);
                    alert('Failed to reset password');
                }
            }
        }

        // Handle logout
        function handleLogout() {
            localStorage.removeItem(AUTH_KEY);
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('adminDashboard').style.display = 'none';
            document.getElementById('loginForm').reset();
        }

        // Check authentication status
        function checkAuth() {
            const token = localStorage.getItem(AUTH_KEY);
            if (!token) {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('adminDashboard').style.display = 'none';
                return false;
            }
            
            // Verify token with server
            fetch('http://localhost:3000/api/verify-token', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('loginPage').style.display = 'none';
                    document.getElementById('adminDashboard').style.display = 'block';
                    
                    // Load initial data for active tabs
                    const activeTab = document.querySelector('.tab-btn.active');
                    if (activeTab && activeTab.getAttribute('data-tab') === 'products') {
                        renderProducts();
                    } else {
                        // Fallback: always load products if authenticated
                        renderProducts();
                    }
                } else {
                    // Token invalid, show login
                    localStorage.removeItem(AUTH_KEY);
                    document.getElementById('loginPage').style.display = 'flex';
                    document.getElementById('adminDashboard').style.display = 'none';
                }
            })
            .catch(error => {
                console.error('Token verification failed:', error);
                // On network error, assume authenticated for now (offline mode)
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                renderProducts();
            });
            
            return true;
        }

        // Check authentication on page load (do not auto-render products here)
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });

        // Rich text editor functions
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('note').focus();
        }

        // Regular products code
        
        // Load products from localStorage or use default products
        function loadProducts() {
            try {
                const stored = localStorage.getItem(PRODUCTS_KEY);
                if (stored) {
                    return JSON.parse(stored);
                }
            } catch (e) {
                console.error('Error loading products:', e);
            }
            
            // Default products if nothing in localStorage
            return [
                {id: '1', title:'Audio FX Pack Pro', price:12, note:'Royalty-free SFX bundle (WAV).', quantity: 50},
                {id: '2', title:'Landing Page Kit', price:9, note:'HTML/CSS responsive sections.', quantity: 30},
                // ... add more default products as needed
            ];
        }

        // Save products to localStorage
        function saveProducts(products) {
            try {
                localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
            } catch (e) {
                console.error('Error saving products:', e);
            }
        }

        // Lightweight UI refresh for the products table (keeps work localized)
        function refreshProductsUI(products) {
            const tbody = document.getElementById('productTableBody');
            if (!tbody) return;
            tbody.innerHTML = '';

            products.forEach(product => {
                // Build row with DOM methods (avoid injecting raw HTML)
                const tr = document.createElement('tr');

                // Helper to safely extract image src if someone pasted an <img> tag
                const extractImageSrc = (val) => {
                    if (!val) return '';
                    if (typeof val !== 'string') return '';
                    const m = val.match(/<img[^>]+src=["']?([^"' >]+)["']?/i);
                    if (m && m[1]) return m[1];
                    return val;
                };

                const imgUrl = extractImageSrc(product.image) || 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="50" height="50"><rect width="50" height="50" fill="%23eee"/><text x="25" y="25" font-family="Arial" font-size="14" text-anchor="middle" dominant-baseline="middle">üì¶</text></svg>';

                const tdImg = document.createElement('td');
                const imgEl = document.createElement('img');
                imgEl.src = imgUrl;
                imgEl.alt = product.title || '';
                imgEl.style.width = '50px';
                imgEl.style.height = '50px';
                imgEl.style.objectFit = 'cover';
                imgEl.style.borderRadius = '4px';
                tdImg.appendChild(imgEl);

                const tdTitle = document.createElement('td');
                tdTitle.textContent = product.title || '';

                const tdPrice = document.createElement('td');
                if (product.offerPrice) {
                    const strike = document.createElement('span');
                    strike.style.textDecoration = 'line-through';
                    strike.style.color = 'var(--muted)';
                    strike.textContent = `$${Number(product.price).toFixed(2)}`;
                    const offer = document.createElement('span');
                    offer.style.color = 'var(--ok)';
                    offer.style.marginLeft = '6px';
                    offer.textContent = `$${Number(product.offerPrice).toFixed(2)}`;
                    tdPrice.appendChild(strike);
                    tdPrice.appendChild(offer);
                } else {
                    tdPrice.textContent = `$${Number(product.price).toFixed(2)}`;
                }

                const tdQty = document.createElement('td');
                tdQty.textContent = product.forceZero ? '0' : String(product.quantity ?? 0);

                const tdStatus = document.createElement('td');
                const spanStatus = document.createElement('span');
                const qtyNum = product.quantity ?? 0;
                if (product.forceZero || qtyNum < 1) {
                    spanStatus.className = 'status-badge status-out-of-stock';
                    spanStatus.textContent = 'Out of Stock';
                } else {
                    spanStatus.className = 'status-badge status-in-stock';
                    spanStatus.textContent = 'In Stock';
                }
                tdStatus.appendChild(spanStatus);

                const tdActions = document.createElement('td');
                tdActions.className = 'actions';
                const btnEdit = document.createElement('button');
                btnEdit.className = 'btn btn-primary';
                btnEdit.textContent = 'Edit';
                btnEdit.addEventListener('click', () => editProduct(product.id));
                const btnDel = document.createElement('button');
                btnDel.className = 'btn btn-danger';
                btnDel.textContent = 'Delete';
                btnDel.addEventListener('click', () => deleteProduct(product.id));
                tdActions.appendChild(btnEdit);
                tdActions.appendChild(btnDel);

                tr.appendChild(tdImg);
                tr.appendChild(tdTitle);
                tr.appendChild(tdPrice);
                tr.appendChild(tdQty);
                tr.appendChild(tdStatus);
                tr.appendChild(tdActions);

                tbody.appendChild(tr);
            });
        }

        // Render products table (calls the UI-only refresher). This keeps rendering fast and localized
        let _lastProductsRender = 0;
        const PRODUCTS_RENDER_MIN_INTERVAL = 5000; // ms - minimum time between auto-renders

        function renderProducts(force = false) {
            try {
                const now = Date.now();
                if (!force && (now - _lastProductsRender) < PRODUCTS_RENDER_MIN_INTERVAL) {
                    // Too soon since last render; skip to avoid rapid refreshes
                    return;
                }
                _lastProductsRender = now;

                // Show a lightweight loading state
                const section = document.querySelector('.product-section');
                if (section) section.style.opacity = '0.6';

                const products = loadProducts();
                refreshProductsUI(products);

                if (section) section.style.opacity = '';
            } catch (err) {
                console.error('renderProducts error:', err);
            }
        }

        // Open modal for adding new product
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'Add New Product';
            document.getElementById('productForm').reset();
            document.getElementById('productId').value = '';
            document.getElementById('imagePreview').hidden = true;
            document.getElementById('editModal').style.display = 'block';
        }

        // Open modal for editing product
        function editProduct(id) {
            const products = loadProducts();
            const product = products.find(p => p.id === id);
            if (!product) return;

            document.getElementById('modalTitle').textContent = 'Edit Product';
            document.getElementById('productId').value = product.id;
            document.getElementById('title').value = product.title;
            document.getElementById('price').value = product.price;
            document.getElementById('offerPrice').value = product.offerPrice || '';
            document.getElementById('quantity').value = product.quantity;
            document.getElementById('note').innerHTML = product.note || '';
            document.getElementById('image').value = product.image || '';
            document.getElementById('forceZero').checked = product.forceZero || false;
            
            const preview = document.getElementById('imagePreview');
            if (product.image) {
                preview.src = product.image;
                preview.hidden = false;
            } else {
                preview.hidden = true;
            }

            document.getElementById('editModal').style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        // Save product changes
        function saveProduct(event) {
            event.preventDefault();
            
            const products = loadProducts();
            const productId = document.getElementById('productId').value;
            // sanitize image field: if the user pasted an <img ...> element, extract its src
            const rawImage = document.getElementById('image').value;
            const extractImageSrc = (val) => {
                if (!val) return '';
                if (typeof val !== 'string') return '';
                const m = val.match(/<img[^>]+src=["']?([^"' >]+)["']?/i);
                if (m && m[1]) return m[1];
                return val;
            };

            const newProduct = {
                id: productId || Date.now().toString(),
                title: document.getElementById('title').value,
                price: parseFloat(document.getElementById('price').value),
                offerPrice: document.getElementById('offerPrice').value ? parseFloat(document.getElementById('offerPrice').value) : null,
                quantity: parseInt(document.getElementById('quantity').value),
                note: document.getElementById('note').innerHTML,
                image: extractImageSrc(rawImage),
                forceZero: document.getElementById('forceZero').checked
            };

            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    products[index] = { ...products[index], ...newProduct };
                }
            } else {
                // Add new product
                products.push(newProduct);
            }

            saveProducts(products);
            renderProducts(true);
            closeModal();
        }

        // Delete product
        function deleteProduct(id) {
            if (!confirm('Are you sure you want to delete this product?')) return;
            
            const products = loadProducts();
            const filtered = products.filter(p => p.id !== id);
            saveProducts(filtered);
            renderProducts(true);
        }

        // Image preview (guarded in case element is not present)
        (function(){
            const imageInput = document.getElementById('image');
            const preview = document.getElementById('imagePreview');
            if (!imageInput || !preview) return;
            imageInput.addEventListener('input', function(e) {
                if (e.target.value) {
                    preview.src = e.target.value;
                    preview.hidden = false;
                } else {
                    preview.hidden = true;
                }
            });
        })();

        // User Management Functions
        async function loadUsers() {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/admin/users', {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                const data = await response.json();
                
                if (data.success) {
                    displayUsers(data.users);
                } else {
                    console.error('Failed to load users:', data.message);
                }
            } catch (error) {
                console.error('Error loading users:', error);
            }
        }

        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach((user, index) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td><span class="role-badge role-${user.role}">${user.role}</span></td>
                    <td><span class="status-badge status-${user.status || 'active'}">${user.status || 'active'}</span></td>
                    <td>${user.lastLogin ? formatDate(user.lastLogin) : 'Never'}</td>
                    <td class="actions">
                        <button class="btn btn-primary btn-sm" onclick="editUser('${user.username}')">Edit</button>
                        <button class="btn btn-danger btn-sm" onclick="deleteUser('${user.username}')">Delete</button>
                        <button class="btn btn-info btn-sm" onclick="resetPassword('${user.username}')">Reset Password</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        async function addUser(event) {
            event.preventDefault();
            const username = document.getElementById('userUsername').value;
            const email = document.getElementById('userEmail').value;
            const role = document.getElementById('userRole').value;
            const password = document.getElementById('userPassword').value;

            if (!username || !email || !role || !password) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/admin/users', {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, email, role, password })
                });

                const data = await response.json();

                if (data.success) {
                    // Clear form
                    document.getElementById('userForm').reset();
                    loadUsers();
                    alert('User added successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert('Failed to add user');
            }
        }

        async function editUser(username) {
            // For now, just show an alert. In a full implementation, you'd fetch user data and populate the form
            alert(`Edit user: ${username}\n\nThis would populate the form with user data for editing.`);
        }

        async function deleteUser(username) {
            if (confirm(`Are you sure you want to delete user: ${username}?`)) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/admin/users/${username}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        }
                    });

                    const data = await response.json();

                    if (data.success) {
                        loadUsers();
                        alert('User deleted successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error deleting user:', error);
                    alert('Failed to delete user');
                }
            }
        }

        async function resetPassword(username) {
            const newPassword = prompt(`Enter new temporary password for ${username}:`);
            if (newPassword) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/admin/users/${username}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password: newPassword })
                    });

                    const data = await response.json();

                    if (data.success) {
                        alert('Password reset successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error resetting password:', error);
                    alert('Failed to reset password');
                }
            }
        }

        // Pages Management Functions
        async function loadPages() {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/pages', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (data.success) {
                    renderPages(data.pages);
                } else {
                    console.error('Failed to load pages:', data.message);
                }
            } catch (error) {
                console.error('Error loading pages:', error);
            }
        }

        function renderPages(pages) {
            const tbody = document.getElementById('pagesTableBody');
            tbody.innerHTML = '';
            
            pages.forEach(page => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${page.title}</td>
                    <td>${page.slug}</td>
                    <td><span class="status-badge status-${page.status === 'published' ? 'active' : 'inactive'}">${page.status}</span></td>
                    <td>${new Date(page.updatedAt).toLocaleDateString()}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editPage('${page.id}')">Edit</button>
                        <button class="btn-delete" onclick="deletePage('${page.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function addPage(event) {
            event.preventDefault();
            const title = document.getElementById('pageTitle').value;
            const slug = document.getElementById('pageSlug').value;
            const content = document.getElementById('pageContent').value;
            const status = document.getElementById('pageStatus').value;
            const editId = document.getElementById('pageEditId').value;

            if (!title || !slug || !content) {
                alert('Please fill in all fields');
                return;
            }

            try {
                const token = localStorage.getItem(AUTH_KEY);
                const method = editId ? 'PUT' : 'POST';
                const url = editId ? `http://localhost:3000/api/pages/${editId}` : 'http://localhost:3000/api/pages';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title, slug, content, status })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('pageForm').reset();
                    document.getElementById('pageEditId').value = '';
                    document.getElementById('pageFormTitle').textContent = 'Add New Page';
                    document.getElementById('pageSubmitBtn').textContent = 'Add Page';
                    document.getElementById('pageCancelBtn').style.display = 'none';
                    loadPages();
                    alert(editId ? 'Page updated successfully!' : 'Page added successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error saving page:', error);
                alert('Failed to save page');
            }
        }

        async function editPage(id) {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch(`http://localhost:3000/api/pages`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (data.success) {
                    const page = data.pages.find(p => p.id === id);
                    if (page) {
                        document.getElementById('pageEditId').value = page.id;
                        document.getElementById('pageTitle').value = page.title;
                        document.getElementById('pageSlug').value = page.slug;
                        document.getElementById('pageContent').value = page.content;
                        document.getElementById('pageStatus').value = page.status;
                        document.getElementById('pageFormTitle').textContent = 'Edit Page';
                        document.getElementById('pageSubmitBtn').textContent = 'Update Page';
                        document.getElementById('pageCancelBtn').style.display = 'inline-block';
                        document.getElementById('pageTitle').focus();
                    }
                }
            } catch (error) {
                console.error('Error loading page for edit:', error);
            }
        }

        function cancelPageEdit() {
            document.getElementById('pageForm').reset();
            document.getElementById('pageEditId').value = '';
            document.getElementById('pageFormTitle').textContent = 'Add New Page';
            document.getElementById('pageSubmitBtn').textContent = 'Add Page';
            document.getElementById('pageCancelBtn').style.display = 'none';
        }

        async function deletePage(id) {
            if (confirm('Are you sure you want to delete this page?')) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/pages/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    const data = await response.json();

                    if (data.success) {
                        loadPages();
                        alert('Page deleted successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error deleting page:', error);
                    alert('Failed to delete page');
                }
            }
        }

        // Posts Management Functions
        async function loadPosts() {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/posts', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (data.success) {
                    renderPosts(data.posts);
                } else {
                    console.error('Failed to load posts:', data.message);
                }
            } catch (error) {
                console.error('Error loading posts:', error);
            }
        }

        function renderPosts(posts) {
            const tbody = document.getElementById('postsTableBody');
            tbody.innerHTML = '';
            
            posts.forEach(post => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${post.title}</td>
                    <td>${post.slug}</td>
                    <td>${post.categories ? post.categories.join(', ') : ''}</td>
                    <td><span class="status-badge status-${post.status === 'published' ? 'active' : 'inactive'}">${post.status}</span></td>
                    <td>${new Date(post.updatedAt).toLocaleDateString()}</td>
                    <td class="actions">
                        <button class="btn-edit" onclick="editPost('${post.id}')">Edit</button>
                        <button class="btn-delete" onclick="deletePost('${post.id}')">Delete</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        async function addPost(event) {
            event.preventDefault();
            const title = document.getElementById('postTitle').value;
            const slug = document.getElementById('postSlug').value;
            const content = document.getElementById('postContent').value;
            const categories = document.getElementById('postCategories').value.split(',').map(c => c.trim()).filter(c => c);
            const tags = document.getElementById('postTags').value.split(',').map(t => t.trim()).filter(t => t);
            const status = document.getElementById('postStatus').value;
            const editId = document.getElementById('postEditId').value;

            if (!title || !slug || !content) {
                alert('Please fill in all required fields');
                return;
            }

            try {
                const token = localStorage.getItem(AUTH_KEY);
                const method = editId ? 'PUT' : 'POST';
                const url = editId ? `http://localhost:3000/api/posts/${editId}` : 'http://localhost:3000/api/posts';
                
                const response = await fetch(url, {
                    method,
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ title, slug, content, status, categories, tags })
                });

                const data = await response.json();

                if (data.success) {
                    document.getElementById('postForm').reset();
                    document.getElementById('postEditId').value = '';
                    document.getElementById('postFormTitle').textContent = 'Add New Post';
                    document.getElementById('postSubmitBtn').textContent = 'Add Post';
                    document.getElementById('postCancelBtn').style.display = 'none';
                    loadPosts();
                    alert(editId ? 'Post updated successfully!' : 'Post added successfully!');
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error saving post:', error);
                alert('Failed to save post');
            }
        }

        async function editPost(id) {
            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch(`http://localhost:3000/api/posts`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await response.json();
                if (data.success) {
                    const post = data.posts.find(p => p.id === id);
                    if (post) {
                        document.getElementById('postEditId').value = post.id;
                        document.getElementById('postTitle').value = post.title;
                        document.getElementById('postSlug').value = post.slug;
                        document.getElementById('postContent').value = post.content;
                        document.getElementById('postCategories').value = post.categories ? post.categories.join(', ') : '';
                        document.getElementById('postTags').value = post.tags ? post.tags.join(', ') : '';
                        document.getElementById('postStatus').value = post.status;
                        document.getElementById('postFormTitle').textContent = 'Edit Post';
                        document.getElementById('postSubmitBtn').textContent = 'Update Post';
                        document.getElementById('postCancelBtn').style.display = 'inline-block';
                        document.getElementById('postTitle').focus();
                    }
                }
            } catch (error) {
                console.error('Error loading post for edit:', error);
            }
        }

        function cancelPostEdit() {
            document.getElementById('postForm').reset();
            document.getElementById('postEditId').value = '';
            document.getElementById('postFormTitle').textContent = 'Add New Post';
            document.getElementById('postSubmitBtn').textContent = 'Add Post';
            document.getElementById('postCancelBtn').style.display = 'none';
        }

        async function deletePost(id) {
            if (confirm('Are you sure you want to delete this post?')) {
                try {
                    const token = localStorage.getItem(AUTH_KEY);
                    const response = await fetch(`http://localhost:3000/api/posts/${id}`, {
                        method: 'DELETE',
                        headers: { 'Authorization': `Bearer ${token}` }
                    });

                    const data = await response.json();

                    if (data.success) {
                        loadPosts();
                        alert('Post deleted successfully!');
                    } else {
                        alert('Error: ' + data.message);
                    }
                } catch (error) {
                    console.error('Error deleting post:', error);
                    alert('Failed to delete post');
                }
            }
        }

        // Tab switching function
        function switchTab(tabName) {
            console.log('Switching to tab:', tabName);
            
            // Hide all tab contents
            const tabs = document.querySelectorAll('.tab-content');
            console.log('Found tabs:', tabs.length);
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active class from all tab buttons
            const buttons = document.querySelectorAll('.tab-btn');
            buttons.forEach(btn => btn.classList.remove('active'));
            
            // Show selected tab
            const targetTab = document.getElementById(tabName + 'Tab');
            console.log('Target tab element:', targetTab);
            if (targetTab) {
                targetTab.classList.add('active');
                console.log('Added active class to tab');
            } else {
                console.error('Tab not found:', tabName + 'Tab');
            }
            
            // Add active class to clicked button
            const clickedButton = document.querySelector(`[data-tab="${tabName}"]`);
            console.log('Clicked button:', clickedButton);
            if (clickedButton) {
                clickedButton.classList.add('active');
                console.log('Added active class to button');
            }
            
            // Load data for the tab
            if (tabName === 'users') {
                loadUsers();
            } else if (tabName === 'products') {
                renderProducts();
            } else if (tabName === 'news') {
                loadAdminNews();
            } else if (tabName === 'pages') {
                loadPages();
            } else if (tabName === 'posts') {
                loadPosts();
            }
            // Settings tab doesn't need to load data
        }

        // Update admin credentials
        async function updateAdminCredentials(event) {
            event.preventDefault();
            const username = document.getElementById('adminUsername').value;
            const password = document.getElementById('adminPassword').value;

            if (!username || !password) {
                alert('Please fill in both username and password');
                return;
            }

            if (!confirm('Are you sure you want to change the admin credentials? You will need to log in again with the new credentials.')) {
                return;
            }

            try {
                const token = localStorage.getItem(AUTH_KEY);
                const response = await fetch('http://localhost:3000/api/admin/credentials', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    alert('Admin credentials updated successfully! Please log in again with the new credentials.');
                    handleLogout();
                } else {
                    alert('Error: ' + data.message);
                }
            } catch (error) {
                console.error('Error updating admin credentials:', error);
                alert('Failed to update admin credentials');
            }
        }
    </script>
</body>
</html>